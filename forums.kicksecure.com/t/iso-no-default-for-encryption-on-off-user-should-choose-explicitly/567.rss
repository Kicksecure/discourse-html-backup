<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>ISO - no default for encryption on/off - user should choose explicitly</title>
    <link>https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567</link>
    <description>The user should either:

* select encryption
* not select encryption

But there should be no default choice. The user should make an explicit choice.

This is because unfortunately on Freedom Software Linux desktop distributions, there is no easy way to enable full disk encryption after installation.</description>
    
    <lastBuildDate>Fri, 27 Sep 2024 02:38:57 +0000</lastBuildDate>
    <category>Development</category>
    <atom:link href="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>ISO - no default for encryption on/off - user should choose explicitly</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubpullrequest" data-onebox-src="https://github.com/calamares/calamares/pull/2376">
  <header class="source">

      <a href="https://github.com/calamares/calamares/pull/2376" target="_blank" rel="noopener">github.com/calamares/calamares</a>
  </header>

  <article class="onebox-body">
    <div class="github-row" data-github-private-repo="false">



    <div class="github-icon-container" title="Pull Request">
      <svg width="60" height="60" class="github-icon" viewBox="0 0 12 16" aria-hidden="true"><path fill-rule="evenodd" d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
    </div>

  <div class="github-info-container">



      <h4>
        <a href="https://github.com/calamares/calamares/pull/2376" target="_blank" rel="noopener">[partition] Always update EncryptWidget's m_state when updateState is called</a>
      </h4>

    <div class="branches">
      <code>calamares:calamares</code> ← <code>ArrayBolt3:calamares</code>
    </div>

      <div class="github-info">
        <div class="date">
          opened <span class="discourse-local-date" data-format="ll" data-date="2024-09-25" data-time="23:02:53" data-timezone="UTC">11:02PM - 25 Sep 24 UTC</span>
        </div>

        <div class="user">
          <a href="https://github.com/ArrayBolt3" target="_blank" rel="noopener">
            <img alt="ArrayBolt3" src="https://avatars.githubusercontent.com/u/104878738?v=4" class="onebox-avatar-inline" width="20" height="20">
            ArrayBolt3
          </a>
        </div>

        <div class="lines" title="1 commits changed 1 files with 3 additions and 6 deletions">
          <a href="https://github.com/calamares/calamares/pull/2376/files" target="_blank" rel="noopener">
            <span class="added">+3</span>
            <span class="removed">-6</span>
          </a>
        </div>
      </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">Fixes https://github.com/calamares/calamares/issues/2375</p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/5">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/5</link>
        <pubDate>Fri, 27 Sep 2024 02:38:57 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-567-5</guid>
        <source url="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567.rss">ISO - no default for encryption on/off - user should choose explicitly</source>
      </item>
      <item>
        <title>ISO - no default for encryption on/off - user should choose explicitly</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <aside class="onebox githubcommit" data-onebox-src="https://github.com/ArrayBolt3/live-config-dist/commit/410c62e664e7d1387e7c013867242838ff2cb912">
  <header class="source">

      <a href="https://github.com/ArrayBolt3/live-config-dist/commit/410c62e664e7d1387e7c013867242838ff2cb912" target="_blank" rel="noopener">github.com/ArrayBolt3/live-config-dist</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Commit">
    <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M10.86 7c-.45-1.72-2-3-3.86-3-1.86 0-3.41 1.28-3.86 3H0v2h3.14c.45 1.72 2 3 3.86 3 1.86 0 3.41-1.28 3.86-3H14V7h-3.14zM7 10.2c-1.22 0-2.2-.98-2.2-2.2 0-1.22.98-2.2 2.2-2.2 1.22 0 2.2.98 2.2 2.2 0 1.22-.98 2.2-2.2 2.2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/ArrayBolt3/live-config-dist/commit/410c62e664e7d1387e7c013867242838ff2cb912" target="_blank" rel="noopener">Make formatting less arbitrary, enable preCheckEncryption</a>
    </h4>

    <div class="github-info">
      <div class="date">
        committed <span class="discourse-local-date" data-format="ll" data-date="2024-09-25" data-time="22:42:07" data-timezone="UTC">10:42PM - 25 Sep 24 UTC</span>
      </div>

      <div class="user">
        <a href="https://github.com/ArrayBolt3" target="_blank" rel="noopener">
          <img alt="ArrayBolt3" src="https://avatars.githubusercontent.com/u/104878738?v=4" class="onebox-avatar-inline" width="20" height="20">
          ArrayBolt3
        </a>
      </div>

      <div class="lines" title="changed 1 files with 4 additions and 3 deletions">
        <a href="https://github.com/ArrayBolt3/live-config-dist/commit/410c62e664e7d1387e7c013867242838ff2cb912" target="_blank" rel="noopener">
          <span class="added">+4</span>
          <span class="removed">-3</span>
        </a>
      </div>
    </div>
  </div>
</div>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

<aside class="onebox githubissue" data-onebox-src="https://github.com/calamares/calamares/issues/2375">
  <header class="source">

      <a href="https://github.com/calamares/calamares/issues/2375" target="_blank" rel="noopener">github.com/calamares/calamares</a>
  </header>

  <article class="onebox-body">
    <div class="github-row">
  <div class="github-icon-container" title="Issue" data-github-private-repo="false">
	  <svg width="60" height="60" class="github-icon" viewBox="0 0 14 16" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
  </div>

  <div class="github-info-container">
    <h4>
      <a href="https://github.com/calamares/calamares/issues/2375" target="_blank" rel="noopener">After checking "Encrypt system", the user can proceed past the Partitions screen without entering a passphrase</a>
    </h4>

    <div class="github-info">
      <div class="date">
        opened <span class="discourse-local-date" data-format="ll" data-date="2024-09-25" data-time="23:00:50" data-timezone="UTC">11:00PM - 25 Sep 24 UTC</span>
      </div>


      <div class="user">
        <a href="https://github.com/ArrayBolt3" target="_blank" rel="noopener">
          <img alt="ArrayBolt3" src="https://avatars.githubusercontent.com/u/104878738?v=4" class="onebox-avatar-inline" width="20" height="20">
          ArrayBolt3
        </a>
      </div>
    </div>

    <div class="labels">
    </div>
  </div>
</div>

  <div class="github-row">
    <p class="github-body-container">**Describe the bug**
If the user checks "Encrypt System", the "Next" button rem<span class="show-more-container"><a href="" rel="noopener" class="show-more">…</a></span><span class="excerpt hidden">ains enabled and they can proceed past the partitions screen without entering a passphrase. Unchecking and rechecking the box results in the "Next" button being grayed out as expected.

**To Reproduce**
Steps to reproduce the behavior:
1. Launch Calamares.
2. Click "Next" until you get to the partitions screen.
3. Click "Erase Disk".
4. Check the "Encrypt system" checkbox.
5. Click "Next" (do not enter a passphrase first).

**Expected behavior**
"Next" button should be disabled and unable to be clicked.

**Screenshots and Logs**
![Screenshot_20240925_175929](https://github.com/user-attachments/assets/ab1133bc-0c72-4de7-9285-ab8fc998bee1)

**Additional context**
I debugged this issue using gdb and traced it to a logic error in `src/modules/partition/gui/EncryptWidget.cpp`:

```c++
    // In function EncryptWidget::updateState( const bool notify ):
    // ...
    if ( newState != m_state )
    {   
        m_state = newState;
        if ( notify ) 
        {   
            Q_EMIT stateChanged( m_state );
        }       
    }
```
The `if ( newState != m_state )` is causing the issue.

In the constructor, `m_state` is initialized to `Encryption::Disabled`, but when the constructor calls `updateState()` in EncryptWidget.cpp line 68, `m_state` gets changed to `Encryption::Unconfirmed`. This is because `updateState()` is called while the "Encrypt system" checkbox is still invisible, thus triggering the following code path:

```c++
EncryptWidget::Encryption
EncryptWidget::state() const
{
    Encryption newState = Encryption::Unconfirmed;

    // This `if` statement is entered because the "Encrypt system" check box is invisible since the app is still starting up
    if ( m_ui-&gt;m_encryptCheckBox-&gt;isChecked() || !m_ui-&gt;m_encryptCheckBox-&gt;isVisible() )
    {
        // And naturally, the passphrase text boxes are also empty, so this `if` statement will be skipped over...
        if ( !m_ui-&gt;m_passphraseLineEdit-&gt;text().isEmpty()
             &amp;&amp; m_ui-&gt;m_passphraseLineEdit-&gt;text() == m_ui-&gt;m_confirmLineEdit-&gt;text() )
        {
            newState = Encryption::Confirmed;
        }
        else // ...and this one is run instead, thus returning `Encryption::Unconfirmed` which is what m_state is then set to.
        {
            newState = Encryption::Unconfirmed;
        }
    }
    else
    {
        newState = Encryption::Disabled;
    }

    return newState;
}
```

So ultimately `m_state` ends up being set to `Encryption::Unconfirmed` once the encryption widget's constructor is finished. Then when the user checks the "Encrypt system" checkbox later on, `EncryptWidget::state()` properly determines that the state is `Encryption::Unconfirmed`, but because `m_state` is already `Encryption::Unconfirmed`, it does **not** emit a `stateChanged` signal. This means that `ChoicePage::onEncryptWidgetStateChanged` is not called when the user first checks the checkbox, and thus the "Next" button is not disabled.

Simply removing the `if ( newState != m_state )` statement from EncryptWidget.cpp should be enough to resolve the bug.</span></p>
  </div>

  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>

          <p><a href="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/4">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/4</link>
        <pubDate>Fri, 27 Sep 2024 02:27:38 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-567-4</guid>
        <source url="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567.rss">ISO - no default for encryption on/off - user should choose explicitly</source>
      </item>
      <item>
        <title>ISO - no default for encryption on/off - user should choose explicitly</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>arraybolt3 via Kicksecure Forums:</p>
<blockquote>
<p>There are a few ways one could implement this, some of them more<br>
invasive than others. One way that might work is to simply prevent the<br>
user from proceeding past the partitioning screen if encryption is<br>
enabled but a passphrase isn’t set, and then have the disk encryption<br>
checkbox<em>checked by default</em>.<br>
In that instance a user would be required to either choose a passphrase<br>
or disable encryption. IMO this is the best solution since it should be<br>
reasonably obvious to the user<em>why</em>  they can’t proceed, and it forces them to make a conscious choice, which is the goal.</p>
</blockquote>
<p>This “easy” solution sounds good for now.</p>
<p>Later maybe…</p>
<pre><code class="lang-auto">Do you wish to use Full Disk Encryption (FDE)?

[ ] use FDE
[ ] do not use FDE

Setting up FDE later is very difficult.
</code></pre>
<p>The text needs more work probably if this is even realistic. The text<br>
could be improved to explain what FDE is and whatnot.</p>
<p>“Setting up FDE later is very difficult.” - maybe only show if selecting<br>
“no”</p>
<p>Could be difficult since that might require modifications to the<br>
calamares partition module, which is not written in python.</p>
          <p><a href="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/3">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/3</link>
        <pubDate>Thu, 26 Sep 2024 13:06:00 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-567-3</guid>
        <source url="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567.rss">ISO - no default for encryption on/off - user should choose explicitly</source>
      </item>
      <item>
        <title>ISO - no default for encryption on/off - user should choose explicitly</title>
        <dc:creator><![CDATA[arraybolt3]]></dc:creator>
        <description><![CDATA[
            <p>There are a few ways one could implement this, some of them more invasive than others. One way that might work is to simply prevent the user from proceeding past the partitioning screen if encryption is enabled but a passphrase isn’t set, and then have the disk encryption checkbox <em>checked by default</em>. In that instance a user would be required to either choose a passphrase or disable encryption. IMO this is the best solution since it should be reasonably obvious to the user <em>why</em> they can’t proceed, and it forces them to make a conscious choice, which is the goal.</p>
<p>It’s also possible to make the “Encrypt system” checkbox tristate, but that comes with some disadvantages and probably won’t have good UX (it might not be clear to the user <em>why</em> they can’t proceed, especially since users oftentimes don’t even notice that the disk encryption checkbox is there at all).</p>
          <p><a href="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/2">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/2</link>
        <pubDate>Wed, 25 Sep 2024 20:33:24 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-567-2</guid>
        <source url="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567.rss">ISO - no default for encryption on/off - user should choose explicitly</source>
      </item>
      <item>
        <title>ISO - no default for encryption on/off - user should choose explicitly</title>
        <dc:creator><![CDATA[Patrick]]></dc:creator>
        <description><![CDATA[
            <p>The user should either:</p>
<ul>
<li>select encryption</li>
<li>not select encryption</li>
</ul>
<p>But there should be no default choice. The user should make an explicit choice.</p>
<p>This is because unfortunately on Freedom Software Linux desktop distributions, there is no easy way to enable full disk encryption after installation.</p>
          <p><a href="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/1">Read full topic</a></p>
        ]]></description>
        <link>https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567/1</link>
        <pubDate>Tue, 10 Sep 2024 23:48:18 +0000</pubDate>
        <guid isPermaLink="false">forums.kicksecure.com-post-567-1</guid>
        <source url="https://forums.kicksecure.com/t/iso-no-default-for-encryption-on-off-user-should-choose-explicitly/567.rss">ISO - no default for encryption on/off - user should choose explicitly</source>
      </item>
  </channel>
</rss>
